<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="../css/bootstrap.min.css">
        <style>body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>
        <link rel="stylesheet" href="../css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="../css/main.css">

        <script src="../js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="../index.html">ITP DWD SPRING 2013</a>
                    <div class="nav-collapse collapse">
                        <ul class="nav">
                            <li class="active"><a href="../index.html">Home</a></li>
                            <!-- <li><a href="#about">About</a></li>
                            <li><a href="#contact">Contact</a></li>-->
                            <li class="dropdown">
                                <a href="week-11.html#" class="dropdown-toggle" data-toggle="dropdown">Notes <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="../page/cheatsheet.html">DWD Cheatsheet</a>
                                    </li>
                                  <li>
                                    <a href="week-1.html">
                                    Week 1 - Introduction to web development
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-2.html">
                                    Week 2 - JavaScript functions, events &amp; callbacks
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-3.html">
                                    Week 3 - Getting started with NodeJS &amp; Heroku
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-4.html">
                                    Week 4 - ExpressJS framework &amp; templates
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-5.html">
                                    Week 5 - Databases and MongoDB
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-6.html">
                                    Week 6 - More on Databases
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-7.html">
                                    Week 7 - Database review and form validation
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-8.html">
                                    Week 8 -  Introduction to API&#39;s &amp; JSON
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-9.html">
                                    Week 9 - Remote APIs, JSON and AJAX
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-10.html">
                                    Week 10 - Sessions and Cookies
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-11.html">
                                    Week 11 - Uploading files / Amazon S3
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-12.html">
                                    Week 12 - Websockets and real-time communication
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-13.html">
                                    Week 13 - Arduinos, Processing and JSON 
                                    </a>
                                  </li>
                                  <li>
                                    <a href="week-14.html">
                                    Week 14 - Final Presentations
                                    </a>
                                  </li>
                               <!--      <li><a href="#">Action</a></li>
                                    <li><a href="#">Another action</a></li>
                                    <li><a href="#">Something else here</a></li>
                                    <li class="divider"></li>
                                    <li class="nav-header">Nav header</li>
                                    <li><a href="#">Separated link</a></li>
                                    <li><a href="#">One more separated link</a></li> -->
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="week-11.html#" class="dropdown-toggle" data-toggle="dropdown">Previous Classes <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="http://itppyweb.herokuapp.com">Fall 2012 - Python</a>
                                    </li>
                                    <li>
                                        <a href="http://itpwebclassspring2012.herokuapp.com">Spring 2012 - NodeJS</a>
                                    </li>
                                </ul>
                            </li>
                            
                        </ul>
                        <form class="hide navbar-form pull-right">
                            <input class="span2" type="text" placeholder="Email">
                            <input class="span2" type="password" placeholder="Password">
                            <button type="submit" class="btn">Sign in</button>
                        </form>
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>

        <div class="container">

            <div class="row">

    <div class="span2">
        <div class="well">
            <a href="week-11.html#notes">Notes</a><br>
            <a href="week-11.html#assignment">Assignment</a>
        </div>
    </div>

    <div class="span10">
        <article>
            <header>
                <h1>Week 11 - Uploading files / Amazon S3</h1>
            
            </header>
            
            <div class="intro">
                <p>How to accept file uploads and store them on Amazon's S3 storage service.</p>
            </div>

            <hr>
            
            <section id="notes">
                <h2 id="amazon-web-services">Amazon Web Services</h2>

<h3>
<li><a href="http://dwd-nodejs-s3.herokuapp.com/">S3 Upload Demo</a></li>
<li><a href="https://github.com/johnschimmel/DWD-NodeJS-S3-Demo">Github</a></li></h3>

<p>This app uses Amazon S3 Web Service for storage of the uploaded images. You must have an Amazon AWS account AND have your access credentials </p>

<h3 id="register-with-amazon-web-services">Register with Amazon Web Services</h3>

<p>Create an account on Amazon Web Services, you can use your Amazon account, <a href="http://aws.amazon.com/console/">http://aws.amazon.com/console/</a> Click on the Sign Up button.</p>

<h3 id="log-in-and-create-new-s3-bucket">Log in and create new S3 bucket</h3>

<p>When you're registered and logged into the AWS site, visit the console, <a href="https://console.aws.amazon.com/console/home?#">https://console.aws.amazon.com/console/home?#</a></p>

<p>In the Storage and Content Delivery section click on S3, scalable storage in the cloud, <a href="https://console.aws.amazon.com/s3/home">https://console.aws.amazon.com/s3/home</a>.</p>

<p>Now we will create a bucket (like a directory). The bucket will be the container for your uploaded files. On the left panel of the S3 console, click 'Create Bucket'. Provide a <strong>bucket name</strong> and leave the <strong>Region</strong> to US Standard. Then click <strong>Create</strong>.</p>

<h3 id="add-environment-variables-to-env-and-heroku">Add environment variables to .env and Heroku</h3>

<p>Inside the AWS Console, on the top menu bar click on your name, then click <strong>SECURITY CREDENTIALS</strong>.</p>

<p>On the SECURITY CREDENTIALS page, you will have access to</p>

<ul>
<li>ACCESS KEY ID</li>
<li>SECRET ACCESS KEY</li>
</ul>

<p>Open your .env file and add 2 new variables for Amazon AWS</p>

<p><strong>.env</strong></p>

<pre><code>AWS_ACCESS_KEY=XXXXXXXXXXXX
AWS_SECRET_KEY=XXXXXXXXXXX
</code></pre>

<p>Save your .env file.</p>

<p>Now let's push the new AWS variable to Heroku config, run the commands in Terminal</p>

<pre><code>heroku config:add AWS_ACCESS_KEY_ID=XXXXXXXXXXX
heroku config:add AWS_SECRET_ACCESS_KEY=XXXXXXXXXXX
</code></pre>

<p>You can confirm the AWS variables are on heroku by running the command,</p>

<pre><code>heroku config
</code></pre>

-----

<h3 id="file-upload">File Upload</h3>

<ul>
<li>HTML file upload enctype attribute must be "<strong>multipart/form-data</strong>"</li>
<li><p>Method must be POST</p>


<pre><code>&lt;form method="POST" action="/newphoto" enctype="multipart/form-data"&gt;

&lt;div class="field "&gt;
    &lt;label for="title"&gt;Title&lt;/label&gt;
    &lt;input type="text" name="title" id="title" &gt;
&lt;/div&gt;

&lt;div class="field "&gt;
    &lt;label for="caption"&gt;Caption&lt;/label&gt;
    &lt;input type="text" name="caption" id="caption" &gt;
&lt;/div&gt;

&lt;div class="field"&gt;
    &lt;label for="image"&gt;Image Upload&lt;/label&gt;
    &lt;input type="file" name="image" id="image"&gt;
&lt;/div&gt;

&lt;input type="submit" class="btn" value="Save"&gt;
</code></pre>

</form></li>
</ul>

<h3 id="receiving-a-file-upload-via-post">Receiving a file upload via POST</h3>

<p><strong>package.json</strong></p>

<p>Add AWS-SDK-JS to your package.json file. Run <strong>npm install</strong>.</p>

<p><strong>app.js</strong></p>

<pre><code>app.post('/newphoto', routes.new_photo);
</code></pre>

<p><strong>/routes/index.js</strong></p>

<h4 id="configure-the-aws-sdk">Configure the AWS-SDK</h4>

<pre><code>var fs = require('fs');
var AWS = require('aws-sdk');
AWS.config.update({
  accessKeyId: process.env.AWS_ACCESS_KEY,
  secretAccessKey: process.env.AWS_SECRET_KEY
});
var s3 = new AWS.S3();
</code></pre>

<h4 id="the-upload-handler">The upload handler</h4>
<script src="https://gist.github.com/johnschimmel/5421308.js"></script>

            </section>
            <br>
            <hr>
            <br>
            <section id="assigment">
                <h1>Assignment</h1>

<p>Most important - Continue working on your final web projects.</p>
<p>Sign up for Amazon AWS account and create a Bucket on S3. Upload a test file and set the permissions to Public. Test the URL for the file is public.</p>
<p>The S3 code above might not be needed for all projects but you could review the code to see how the connection to S3 was established and how the uploaded object was PUT to Amazon.</p>
            </section>

            <section id="comments">
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'itpdwdspring2013';

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
            </section>


        </article>
        
    </div>

    
</div>

        </div> <!-- /container -->

        <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/js/vendor/jquery-1.9.0.min.js"><\/script>')</script>

        <script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.2.2/bootstrap.min.js"></script>

        <script src="../js/main.js"></script>

        <script>
            var _gaq=[['_setAccount','UA-29253415-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>
